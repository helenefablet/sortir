{% extends 'base.html.twig' %}

{% block title %}Nouvelle Sortie{% endblock %}

{% block body %}
    <h1>Cr√©er une Sortie</h1>


    {{ form_start(formS,{'attr':{'id': 'formS'}}) }}
    {{ form_row(formS.nom) }}
    {{ form_row(formS.dateHeureDebut) }}
    {{ form_row(formS.dateLimiteInscription) }}
    {{ form_row(formS.nbInscriptionsMax) }}
    {{ form_row(formS.duree) }}
    {{ form_row(formS.infosSortie) }}

    {{ app.user.campus.nom }}
    {{ form_row(formS.ville) }}
    {{ form_row(formS.lieu) }}
    <a href="{{ path('lieu_new') }}"><img src="{{ asset('img/bouton_plus.png') }}" alt=""></a>

    {{ form_end(formS) }}

    <button onclick="enregistrer()" name="newSortie" id="enregistrer" value="0">Enregistrer</button>
    <button onclick="publier()" name="newSortie" id="publier" value="1">Publier</button>
    {#  <a href="{{ path('sortie_index') }}">Annuler</a> #}


    <script>
       function enregistrer(){
            console.log(0);
            document.querySelector("#formS").submit();
        }
       function publier(){
            console.log(1);
            document.querySelector("#formS").submit();
        }



        // PARTIE VILLE / LIEUX
           let villes =[];

           function changeLieux()
           {
               let lieuId = document.querySelector('#lieu').value;
               afficherVilles(lieuxId);
           }
           //-----------------------------------
           function afficherVilles(lieuxId)
           {
               let selectVille = document.querySelector('#ville');
               selectVille.innerHTML ='';
               // je parcours les villes pour trouver le bon lieu
               for (let v of villes)
           {
               if(lieuxId == v.lieux){

               let option = document.createElement('option'); //<option></option>
               option.setAttribute('value',v.id); //<option value="42"></option>
               option.textContent = v.nom; //<option value="42"> rouge</option>
               selectVille.appendChild(option);

           }
           }
           }
           //-----------------------------------
           function afficherLieux(tab)
           {
               for (l of tab)
           {
               let option = document.createElement('option');
               option.setAttribute('value',l.id);
               option.textContent = l.nom;
               document.querySelector('#lieu').appendChild(option);

           }
           }
           //-----------------------------------


           let url ="sortie/newLiaison/";
           fetch(url)
                .then( response => response.json())
                .then(
                    objet => {
                        console.log(objet);
                        afficherLieux(objet.lieux);

                        let lieuxId = objet.lieux[0].id;
                        console.log(lieuxId);
                        villes = objet.villes;
                        afficherVilles(lieuxId);
       });
    </script>
{% endblock %}


