{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
    <header>
        <div>
            <p>Date du jour : {{ "now" | date('d/m/Y H:i') }}</p>
            <p>Participant : {{ app.user.prenom }}  {{ app.user.nom | slice(0,1)~"." }}</p>
        </div>
    </header>
    <main>

        <div>
            <h2>Filtrer les sorties</h2>
            {{ form_start(form) }}
            {{ form_widget(form) }}
            <button type="submit">Rechercher</button>
            {{ form_end(form) }}

        <hr>

        <a href="{{ path('sortie_new', {'id': app.user.id}) }}">Créer une sortie</a><br>

        <table>
            <thead>
            <th>
                <tr>Nom de la sortie</tr>
                <tr>Lieu - Ville</tr>
                <tr>Date de la sortie</tr>
                <tr>Clôture</tr>
                <tr>Inscrits/Places</tr>
                <tr>Etat</tr>
                <tr>Inscrit</tr>
                <tr>Organisateur</tr>
                <tr>Actions</tr>
            </th>
            </thead>
            <tbody>

                {% for sortie in sorties %}

                    <tr>
                        <td>{{ sortie.nom }}</td>
                        <td>{{ sortie.lieu.nom }} - {{ sortie.lieu.ville.nom }}</td>
                        <td>{{ sortie.dateHeureDebut ? sortie.dateHeureDebut|format_datetime('short', 'short', locale='fr') : '' }}</td>
                        <td>{{ sortie.dateLimiteInscription ? sortie.dateLimiteInscription|date('d/m/Y') : '' }}</td>
                        <td>{{ sortie.participants.count }}/{{ sortie.nbInscriptionsMax }}</td>
                        <td>{{ sortie.etat.libelle}}</td>
                        <td>
                            {% if sortie.participants.contains(app.user) %}
                                <p>X</p>
                            {% endif %}
                        </td>

                       {% if not sortie.organisateur.pseudo %}
                           <td><a href="{{ path('participant_afficherProfil', {'id': sortie.organisateur.id}) }}">{{sortie.organisateur.prenom }} {{ sortie.organisateur.nom | slice(0,1)~"." }} </a></td>
                       {% else %}
                           <td><a href="{{ path('participant_afficherProfil', {'id': sortie.organisateur.id}) }}">{{sortie.organisateur.pseudo }} </a></td>
                       {% endif %}

                        <td>
                            {% if (app.user.id == sortie.organisateur.id) or ( is_granted('ROLE_ADMIN')) %}
                                <a href="{{ path('sortie_edit', {'id': sortie.id}) }}">Modifier</a>
                                <a href="{{ path('sortie_publier', {'id': sortie.id}) }}">Publier</a>
                                <a href="{{ path('sortie_annuler', {'id': sortie.id}) }}">Annuler</a>
                            {% endif %}

                            <a href="{{ path('sortie_show', {'id': sortie.id}) }}">Afficher</a>

                            {% if sortie.participants.contains(app.user) %}
                                <a href="{{ path('_seDesister', { id : sortie.id}) }}">Se désister</a>
                            {% else %}
                                <a href="{{ path('_sinscrire', { id: sortie.id}) }}">S'inscrire</a>
                            {% endif %}

                        </td>

                    </tr>
                {% else %}
                    <p>Aucune sortie</p>
                {% endfor %}
            </tbody>
        </table>

        <a href="{{ path('sortie_new', {'id': app.user.id}) }}">Créer une sortie</a>
    </main>
{% endblock %}
